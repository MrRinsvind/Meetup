import isEquil from 'lodash/isEqual'
import { TimelineMax } from 'gsap'

let ds = [343.06,357.75,369.06,343.12,342.62,321.38,
310.31,361.62,343.06,357.75,327.69,329,
327.69,329,343.06,357.75,342.62,321.38,
277.69,330.75,310.31,361.62,305.31,330.75,
240.69,361.62,310.31,361.62,277.69,330.75,
356.06,270.12,394.31,271.75,352.31,237.5,
388.69,310.75,394.31,271.75,356.06,270.12,
352.31,303.69,388.69,310.75,356.06,270.12,
369.06,343.12,388.69,310.75,352.31,303.69,
342.62,321.38,369.06,343.12,352.31,303.69,
277.69,209.38,240.69,178.38,277.69,330.75,
343.19,181.88,308.31,178.38,324.69,211.12,
370.81,198.75,343.19,181.88,324.69,211.12,
341.81,219.75,370.81,198.75,324.69,211.12,
388.31,228.44,370.81,198.75,341.81,219.75,
240.69,178.38,240.69,361.62,277.69,330.75,
352.31,237.5,388.31,228.44,341.81,219.75,
308.31,178.38,240.69,178.38,277.69,209.38,
352.31,237.5,394.31,271.75,388.31,228.44,
294.31,209.38,308.31,178.38,277.69,209.38,
324.69,211.12,308.31,178.38,294.31,209.38,
305.31,330.75,310.31,361.62,327.69,329,
463.81,235,439.81,263.25,497.81,247.25,
439.81,263.25,481.56,281.38,497.81,247.25,
497.81,247.25,481.56,281.38,537.75,260.44,
464.19,212.5,430.88,200.19,458.31,223.88,
481.56,281.38,511.19,289.38,537.75,260.44,
458.31,223.88,422.94,226.38,463.81,235,
422.94,226.38,439.81,263.25,463.81,235,
430.88,200.19,422.94,226.38,458.31,223.88,
528.31,308.38,519.25,326.06,565.31,308.25,
558,279.06,528.31,308.38,565.31,308.25,
519.25,326.06,556.56,337.75,565.31,308.25,
524.5,297.31,528.31,308.38,558,279.06,
537.75,260.44,524.5,297.31,558,279.06,
511.19,289.38,524.5,297.31,537.75,260.44,
560.06,230.75,541.75,190.38,512.88,212.06,
416.31,302,438.56,348.81,452.31,298.5,
452.31,298.5,438.56,348.81,465.5,325.12,
492.31,333.62,531.81,358.19,519.25,326.06,
438.56,348.81,491.94,364.88,465.5,325.12,
531.81,358.19,556.56,337.75,519.25,326.06,
465.5,325.12,491.94,364.88,492.31,333.62,
489.44,205.88,489.81,175.25,464.19,212.5,
453.75,181.62,430.88,200.19,464.19,212.5,
489.81,175.25,453.75,181.62,464.19,212.5,
541.75,190.38,489.81,175.25,489.44,205.88,
512.88,212.06,541.75,190.38,489.44,205.88,
523.06,232.38,560.06,230.75,512.88,212.06,
491.94,364.88,531.81,358.19,492.31,333.62]

let meetup = [151.38,327.49,161.71,361.62,170.64,254.25,
  140.83,361.62,161.71,361.62,151.38,327.49,
  131.9,254.25,140.83,361.62,151.38,327.49,
  183.02,277.1,203.16,254.25,170.64,254.25,
  161.71,361.62,183.02,277.1,170.64,254.25,
  203.16,361.62,203.16,254.25,183.02,277.1,
  99.45,361.62,119.59,361.62,99.45,254.25,
  119.59,277.1,140.83,361.62,131.9,254.25,
  99.45,254.25,119.59,277.1,131.9,254.25,
  119.59,361.62,119.59,277.1,99.45,254.25,
  183.02,361.62,203.16,361.62,183.02,277.1,
  300.28,296.22,246.38,296.22,300.28,314.31,
  300.28,314.31,246.38,296.22,246.38,314.31,
  246.38,296.22,224.7,361.62,246.38,343.53,
  304.31,254.25,224.7,254.25,304.31,272.42,
  306.36,361.62,306.36,343.53,246.38,343.53,
  224.7,254.25,224.7,361.62,246.38,296.22,
  246.38,272.42,224.7,254.25,246.38,296.22,
  304.31,272.42,224.7,254.25,246.38,272.42,
  224.7,361.62,306.36,361.62,246.38,343.53,
  346.42,272.42,324.74,361.62,346.42,343.53,
  400.33,314.31,346.42,296.22,346.42,314.31,
  406.41,361.62,406.41,343.53,346.42,343.53,
  324.74,361.62,406.41,361.62,346.42,343.53,
  400.33,296.22,346.42,296.22,400.33,314.31,
  404.36,272.42,324.74,254.25,346.42,272.42,
  404.36,254.25,324.74,254.25,404.36,272.42,
  324.74,254.25,324.74,361.62,346.42,272.42,
  470.64,272.42,502.43,254.25,417.1,254.25,
  417.1,272.42,448.96,272.42,417.1,254.25,
  470.64,361.62,470.64,272.42,448.96,272.42,
  448.96,272.42,470.64,272.42,417.1,254.25,
  502.43,272.42,502.43,254.25,470.64,272.42,
  448.96,361.62,470.64,361.62,448.96,272.42,
  537.95,254.25,516.27,254.25,537.95,312.41,
  601.89,310.65,601.89,254.25,580.21,254.25,
  516.27,254.25,516.27,311.53,537.95,312.41,
  573.62,341.15,593.65,351.44,579.26,331.89,
  560.36,363.46,581.02,360.2,559.71,344.93,
  559.71,344.93,581.02,360.2,573.62,341.15,
  581.02,360.2,593.65,351.44,573.62,341.15,
  579.26,331.89,601.89,310.65,580.21,313.65,
  600.13,337.97,601.89,310.65,579.26,331.89,
  593.65,351.44,600.13,337.97,579.26,331.89,
  537.95,312.41,518.4,338.77,538.76,330.35,
  580.21,313.65,601.89,310.65,580.21,254.25,
  516.27,311.53,518.4,338.77,537.95,312.41,
  518.4,338.77,524.48,350.68,538.76,330.35,
  545.39,340.93,560.36,363.46,559.71,344.93,
  538.76,330.35,537.04,359.9,545.39,340.93,
  537.04,359.9,560.36,363.46,545.39,340.93,
  524.48,350.68,537.04,359.9,538.76,330.35,
  660.56,321.12,683.04,319.58,675.43,301.2,
  646.42,302.88,660.56,321.12,658.29,302.88,
  658.29,302.88,660.56,321.12,675.43,301.2,
  646.42,272.42,624.74,361.62,646.42,361.62,
  683.04,319.58,694.29,314.49,682.2,295.93,
  675.43,301.2,683.04,319.58,682.2,295.93,
  682.2,295.93,703.41,303.91,707,287.28,
  694.29,314.49,703.41,303.91,682.2,295.93,
  624.74,254.25,624.74,361.62,646.42,272.42,
  646.42,321.12,660.56,321.12,646.42,302.88,
  700.77,266.37,685.32,255.86,681.21,277.91,
  684.66,287.58,707,287.28,681.21,277.91,
  659.53,254.25,624.74,254.25,646.42,272.42,
  682.2,295.93,707,287.28,684.66,287.58,
  707,287.28,700.77,266.37,681.21,277.91,
  672.5,273.15,659.53,254.25,656.9,272.42,
  656.9,272.42,659.53,254.25,646.42,272.42,
  685.32,255.86,659.53,254.25,672.5,273.15,
  681.21,277.91,685.32,255.86,672.5,273.15];

var pad_array = function(arr,len,fill) {
  return arr.concat(Array(len).fill(fill)).slice(0,len);
}

ds = pad_array(ds,130*6,300)
meetup = pad_array(meetup,130*6,300)

var canvasElement = document.querySelector("#canvas");
var context = canvasElement.getContext("2d");
context.lineWidth = 1;
context.strokeStyle = '#666666';
context.fillStyle = "#6BBC44";

let current = [...ds]

function render(state) {
  context.clearRect(0,0,800,600)
  for(let i = 0; i <= state.length; i=i+6) {
    context.beginPath();
    context.moveTo(state[i], state[i + 1]);
    context.lineTo(state[i + 2], state[i + 3]);
    context.lineTo(state[i + 4], state[i + 5]);
    context.closePath();
    context.stroke();
    context.fill();
  }
}
render(ds)
let tl = new TimelineMax();
ds.onUpdate = function(){
  render(current)
}
meetup.onUpdate = function(){
  render(current)
}
setInterval(_ => {
  if(isEquil(current, ds)) {
    tl.to(current, 0.5, meetup)
  }
  else if(isEquil(current, meetup)) {
    tl.to(current, 0.5, ds)
  }
}, 2000)
// setInterval(_ => {
//   console.log('current',current)
//   if(isEquil(current, ds)) {
//     current = current.reduce((arr, el, ind) => {
//       const nextStep = [...arr]
//       nextStep[ind] = meetup[ind]
//       if(ind%6) {
//         setTimeout(_ => {
//           render(nextStep)
//         },(1500/ds.length)*ind*2)
//       }
//       return nextStep
//     },[...current])
//   }
//   else if(isEquil(current, meetup)) {
//     current = current.reduce((arr, el, ind) => {
//       const nextStep = [...arr]
//       nextStep[ind] = ds[ind]
//       if(ind%6) {
//         setTimeout(_ => {
//           render(nextStep)
//         },(1500/ds.length)*ind*2)
//       }
//       return nextStep
//     },[...current])
//   }
// }, 4000)